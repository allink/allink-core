{% load thumbnail allink_image_tags cache %}

{% comment %}
    cache for half a year, invalidated when edited
{% endcomment %}
{% cache 15552000 content_image instance.id %}
    <div class="image-container image-plugin {{ instance.css_classes }}">

        {# start render figure/figcaption #}
        {% if instance.caption_text %}
            <figure>
        {% endif %}
        {# end render figure/figcaption #}

            {% if instance.get_link_url %}
                <a href="{{ instance.get_link_url }}"
                    {% if instance.new_window_enabled %} target="_blank"{% endif %}
                    {% if instance.new_window_enabled %}
                        target="_blank"
                    {% endif %}
                    {% if instance.form_modal_enabled %}data-trigger-form-modal{% endif %}
                    {% if instance.image_modal_enabled %}data-trigger-image-modal{% endif %}
                    {% if instance.is_page_link %}data-cms-page{% endif %}
                    {% if instance.softpage_large_enabled or instance.softpage_small_enabled and instance.link_special != 'account_logout' %}data-trigger-softpage{% endif %}
                    {% if instance.softpage_large_enabled %}data-softpage-variation="large"{% endif %}
                    {% if instance.link_anchor %}data-smooth-scroll{% endif %}
                    {% if instance.softpage_small_enabled %}data-softpage-variation="small"{% endif %}
                    {% if instance.link_special == 'account_login' and user.is_authenticated %}data-softpage-disabled{% endif %}
                    {% if instance.link_special == 'account_logout' and user.is_authenticated %}data-submit-form{% endif %}
                    {{ instance.link_attributes_str }}
                    >
            {% endif %}

                {% render_image image=instance.picture ratio=instance.ratio icon_enabled=instance.icon_enabled bg_enabled=instance.bg_enabled %}

            {% if instance.get_link_url %}
                </a>
            {% endif %}

        {# start render figure/figcaption #}
        {% if instance.caption_text %}
                <figcaption>{{ instance.caption_text }}</figcaption>
            </figure>
        {% endif %}

    </div>
{% endcache %}
