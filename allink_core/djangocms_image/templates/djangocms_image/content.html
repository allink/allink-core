{% load thumbnail allink_image_tags cache link_tags %}

{% comment %}
    cache for half a year, invalidated when edited
{% endcomment %}
{% cache 15552000 content_image instance.id %}
    <div class="image-container image-plugin {{ instance.css_classes }}">

        {# start render figure/figcaption #}
        {% if instance.caption_text %}
            <figure>
        {% endif %}
        {# end render figure/figcaption #}

            {% if instance.get_link_url %}
                <a href="{{ instance.get_link_url }}"
                class="{{instance|link_classes}}"
                {{ instance|link_attribute_string:request }}
                >
            {% endif %}

                {% render_image image=instance.picture ratio=instance.ratio icon_enabled=instance.icon_enabled bg_enabled=instance.bg_enabled %}

            {% if instance.get_link_url %}
                </a>
            {% endif %}
        {# start render figure/figcaption #}
        {% if instance.caption_text %}
                <figcaption>{{Â instance.caption_text }}</figcaption>
            </figure>
        {% endif %}

    </div>
{% endcache %}
